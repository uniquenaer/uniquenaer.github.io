(window.webpackJsonp=window.webpackJsonp||[]).push([[38],{226:function(t,s,a){"use strict";a.r(s);var n=a(0),e=Object(n.a)({},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"content"},[a("h1",{attrs:{id:"快速开始"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#快速开始","aria-hidden":"true"}},[t._v("#")]),t._v(" "),a("H2Icon"),t._v(" 快速开始")],1),t._v(" "),t._m(0),t._v(" "),t._m(1),t._v(" "),a("p",[t._v("打开你的命令行工具（terminal），在其中键入:")]),t._v(" "),t._m(2),t._m(3),t._v(" "),t._m(4),t._v(" "),t._m(5),t._v(" "),t._m(6),a("p",[t._v("如果一切顺利，你的电脑里会多出一个 python 的虚拟环境。关于 "),a("code",[t._v("pipenv")]),t._v(" 的更多使用请参考"),a("a",{attrs:{href:"https://pipenv.readthedocs.io/en/latest/",target:"_blank",rel:"noopener noreferrer"}},[t._v("官网"),a("OutboundLink")],1),t._v("。")]),t._v(" "),t._m(7),t._v(" "),t._m(8),t._v(" "),a("p",[t._v("接下来，请用你最喜爱的编辑器打开 starter 项目，我们强烈建议你使用 pycharm（无论是否为个人版，社区版也很好用），当然如果你钟情于 VSCode，这也不会影响你的开发。")]),t._v(" "),t._m(9),t._v(" "),t._m(10),t._v(" "),t._m(11),t._v(" "),t._m(12),a("p",[t._v("请在 "),a("code",[t._v("SQLALCHEMY_DATABASE_URI")]),t._v(" 这项中配置你的数据库，用户和密码，关于 sqlalchemy 的具体使用请参考"),a("a",{attrs:{href:"https://docs.sqlalchemy.org/en/latest/",target:"_blank",rel:"noopener noreferrer"}},[t._v("官网"),a("OutboundLink")],1),t._v("。")]),t._v(" "),t._m(13),t._v(" "),t._m(14),t._v(" "),t._m(15),t._v(" "),a("p",[t._v("接下来，我们将开始一个简单的图书项目，来帮你熟悉整个项目的开发流程。")]),t._v(" "),t._m(16),t._v(" "),t._m(17),t._v(" "),t._m(18),t._m(19),t._v(" "),t._m(20),t._v(" "),t._m(21),a("p",[t._v("如果你熟悉 Flask，应该可以发现这与 Flask 的 API 开发几乎一致，不过我们提供了一个红图的机制，让 API 的开发更加细粒度化。")]),t._v(" "),a("p",[t._v("到此一个简单的图书 API 开发就实现了，但是我们此时运行程序并不能访问到该 API。我们还需要将该红图挂载到项目的默认 API 蓝图上。")]),t._v(" "),t._m(22),t._v(" "),t._m(23),t._m(24),t._v(" "),a("p",[t._v("如果一切顺利，你就可以在 terminal 中看到下面返回数据：")]),t._v(" "),t._m(25),t._m(26),t._v(" "),t._m(27),t._v(" "),t._m(28),a("p",[t._v("我们新建了一个 "),a("code",[t._v("Book")]),t._v(" 的 Model，该模型继承自 "),a("code",[t._v("InfoCrud")]),t._v("，有关于 "),a("code",[t._v("InfoCrud")]),t._v(" 的详细，将在"),a("router-link",{attrs:{to:"./authority_and_models.html"}},[t._v("后续")]),t._v("详细介绍，本章我们注重于 CMS 的开发使用。")],1),t._v(" "),t._m(29),t._v(" "),t._m(30),t._v(" "),t._m(31),t._v(" "),t._m(32),a("p",[t._v("在上面重写的 "),a("code",[t._v("book.py")]),t._v(" 文件中，我们使用到了 "),a("code",[t._v("flask-sqlalchemy")]),t._v(" 提供的便捷查询 API，详细使用请参考"),a("a",{attrs:{href:"http://flask-sqlalchemy.pocoo.org/2.3/",target:"_blank",rel:"noopener noreferrer"}},[t._v("官网"),a("OutboundLink")],1),t._v("。")]),t._v(" "),t._m(33),t._v(" "),t._m(34),t._m(35),t._v(" "),a("p",[t._v("在应用的开发中，尤其是在 Web 领域中，对于任何从用户传入的数据都是无规则可循的，我们无法去预测用户传入的数据，因此参数（数据）校验是开发中不可或缺的一环。")]),t._v(" "),t._m(36),t._v(" "),t._m(37),t._m(38),t._v(" "),t._m(39),t._v(" "),t._m(40),t._m(41),t._v(" "),t._m(42),t._m(43),t._v(" "),t._m(44),t._m(45),t._v(" "),t._m(46),t._v(" "),t._m(47),t._m(48),t._v(" "),a("p",[t._v("然后更改图书搜索未找到图书的异常：")]),t._v(" "),t._m(49),a("p",[t._v("再次运行程序，如果未找到图书，则前端会得到如下提示信息：")]),t._v(" "),t._m(50),t._m(51),t._v(" "),t._m(52),t._v(" "),t._m(53),t._v(" "),t._m(54),t._v(" "),a("RightMenu")],1)},[function(){var t=this.$createElement,s=this._self._c||t;return s("blockquote",[s("p",[this._v("我们提供了一个 CMS 的快速开始的模板（Starter），方便你快速开发。")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"初始化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#初始化","aria-hidden":"true"}},[this._v("#")]),this._v(" 初始化")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{attrs:{class:"token function"}},[this._v("git")]),this._v(" clone -b starter https://git.coding.net/pedrogao/lanyan-server.git\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("由于 python 的版本众多，且差异性也很大，我们强烈建议你通过 "),s("code",[this._v("pipenv")]),this._v(" 来新建虚拟环境开发项目，在我们的"),s("em",[this._v("starter")]),this._v("项目的根目录下有一个名为 "),s("code",[this._v("Pipfile")]),this._v(" 的文件，我们将通过它来创建整个项目的虚拟环境。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("如果你熟悉 Java，那么 "),s("code",[this._v("Pipfile")]),this._v(" 的作用类似于 Maven 中的 "),s("code",[this._v("pom.xml")]),this._v(" ，如果你熟悉 Node.js，那你可以把它的功能类比于 "),s("code",[this._v("package.json")]),this._v("。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("如果你还未使用过 "),s("code",[this._v("pipenv")]),this._v(" 或者未接触过它，请确保你有正确的 python 环境，并使用 "),s("code",[this._v("pip")]),this._v(" 安装 "),s("code",[this._v("pipenv")]),this._v("。 接下在，继续在命令行中输入：")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{attrs:{class:"token function"}},[t._v("cd")]),t._v(" starter "),a("span",{attrs:{class:"token operator"}},[t._v("&&")]),t._v(" pipenv shell "),a("span",{attrs:{class:"token operator"}},[t._v("&&")]),t._v(" pipenv "),a("span",{attrs:{class:"token function"}},[t._v("install")]),t._v(" --dev\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("blockquote",[s("p",[this._v("如果你不希望通过 pipenv 来开发，当然我们强烈推荐使用。你也可以通过根目录下的 requirements.txt 来安装相关的依赖\n注意：通过 pipenv 创建的 python 虚拟环境时已经指定了 python 版本为 3.6，如果你通过 requirements.txt 使用，我们希望你与 3.6 版本保持一致，当然我们支持 3.6+的版本")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"快速开发"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#快速开发","aria-hidden":"true"}},[this._v("#")]),this._v(" 快速开发")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"warning custom-block"},[s("p",{staticClass:"custom-block-title"},[this._v("WARNING")]),this._v(" "),s("p",[this._v("在这里，请确保你已经安装好了 python 虚拟环境")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"数据库初始化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#数据库初始化","aria-hidden":"true"}},[this._v("#")]),this._v(" 数据库初始化")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("打开项目后，请先进入 "),s("code",[this._v("app/config/secure.py")]),this._v(" ，如下：")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-py extra-class"},[s("pre",{pre:!0,attrs:{class:"language-py"}},[s("code",[s("span",{attrs:{class:"token comment"}},[this._v("# 数据库配置")]),this._v("\nSQLALCHEMY_DATABASE_URI "),s("span",{attrs:{class:"token operator"}},[this._v("=")]),this._v(" "),s("span",{attrs:{class:"token string"}},[this._v("'mysql+cymysql://root:123456@localhost:3306/lin-cms'")]),this._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("记住"),s("code",[this._v("lin-cms")]),this._v("为数据库名，但是"),s("code",[this._v("sqlalchemy")]),this._v("无法直接创建该数据库，所以请你通过其他数据库工具（如 Navicat）或终端在 mysql 数据库中创建名为"),s("code",[this._v("lin-cms")]),this._v("的数据库，当然你也为该数据库取任何令你心仪的名字。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("创建数据库并配置好后，运行 "),s("code",[this._v("starter.py")]),this._v(" ，如果一切顺利，你将会在控制台的输出中看到程序已经正在运行，并且在你的数据库中会多出几张表，这些我们将在后面讲到。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"开发-api"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#开发-api","aria-hidden":"true"}},[this._v("#")]),this._v(" 开发 API")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"视图控制"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#视图控制","aria-hidden":"true"}},[this._v("#")]),this._v(" 视图控制")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("打开 "),s("code",[this._v("app/api/v1")]),this._v(" 文件夹，在该文件夹里新建 "),s("code",[this._v("book.py")]),this._v(" 文件。我们从 "),s("code",[this._v("Lin")]),this._v(" 从导入红图来创建 API 视图：")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-py extra-class"},[s("pre",{pre:!0,attrs:{class:"language-py"}},[s("code",[s("span",{attrs:{class:"token keyword"}},[this._v("from")]),this._v(" lin"),s("span",{attrs:{class:"token punctuation"}},[this._v(".")]),this._v("redprint "),s("span",{attrs:{class:"token keyword"}},[this._v("import")]),this._v(" Redprint\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("而后，初始化一个名为 "),s("code",[this._v("book_api")]),this._v(" 的红图，并创建一个视图函数"),s("code",[this._v("get_book")]),this._v("：")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"warning custom-block"},[s("p",{staticClass:"custom-block-title"},[this._v("WARNING")]),this._v(" "),s("p",[this._v("请记住此处视图函数所代表的意思，在后续的章节中它会非常重要！！！")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-py extra-class"},[a("pre",{pre:!0,attrs:{class:"language-py"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("from")]),t._v(" lin"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("redprint "),a("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" Redprint\n"),a("span",{attrs:{class:"token keyword"}},[t._v("from")]),t._v(" flask "),a("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" jsonify\n\nbook_api "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" Redprint"),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'book'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n\n@book_api"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("route"),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'/<id>'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" methods"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{attrs:{class:"token string"}},[t._v("'GET'")]),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("get_book")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token builtin"}},[t._v("id")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" jsonify"),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{attrs:{class:"token string"}},[t._v("'msg'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'hello, I am a book'")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("打开 "),s("code",[this._v("app/api/v1/__init__.py")]),this._v(" 文件，向其中添加如下内容：")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-py extra-class"},[a("pre",{pre:!0,attrs:{class:"language-py"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("from")]),t._v(" flask "),a("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" Blueprint\n"),a("span",{attrs:{class:"token keyword"}},[t._v("from")]),t._v(" app"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("api"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("v1 "),a("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" book\n\n\n"),a("span",{attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("create_blueprint_v1")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    bp_v1 "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" Blueprint"),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'v1'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" __name__"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    book"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("book_api"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("register"),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("bp_v1"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" bp_v1\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("现在，我们已经可以通过 HTTP 请求到该 API 了，运行程序。然后通过 curl（你可以使用任何你喜爱的测试工具，postman 甚至浏览器都行） 访问 "),s("code",[this._v("http://127.0.0.1:5000/v1/book/1")]),this._v("。")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-py extra-class"},[a("pre",{pre:!0,attrs:{class:"language-py"}},[a("code",[a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{attrs:{class:"token string"}},[t._v('"msg"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"hello, I am a book"')]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"模型使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#模型使用","aria-hidden":"true"}},[this._v("#")]),this._v(" 模型使用")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("打开 "),s("code",[this._v("app/models")]),this._v(" 文件夹，在该文件夹下新建 "),s("code",[this._v("book.py")]),this._v(" 文件，并加入以下内容：")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-py extra-class"},[a("pre",{pre:!0,attrs:{class:"language-py"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("from")]),t._v(" sqlalchemy "),a("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" Column"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" String"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Integer\n\n"),a("span",{attrs:{class:"token keyword"}},[t._v("from")]),t._v(" lin"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("interface "),a("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" InfoCrud "),a("span",{attrs:{class:"token keyword"}},[t._v("as")]),t._v(" Base\n\n\n"),a("span",{attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("Book")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Base"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{attrs:{class:"token builtin"}},[t._v("id")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" Column"),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Integer"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" primary_key"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token boolean"}},[t._v("True")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" autoincrement"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token boolean"}},[t._v("True")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    title "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" Column"),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("String"),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token number"}},[t._v("50")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" nullable"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token boolean"}},[t._v("False")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    author "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" Column"),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("String"),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token number"}},[t._v("30")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" default"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token string"}},[t._v("'未名'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    summary "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" Column"),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("String"),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token number"}},[t._v("1000")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    image "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" Column"),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("String"),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token number"}},[t._v("50")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("有了该模型后，我们打开根目录下的 "),s("code",[this._v("fake.py")]),this._v(" 文件，并运行 "),s("code",[this._v("fake.py")]),this._v(" 文件，如果你的操作正确，你的数据库将会在多出两条书籍的数据。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("下面，我们继续完善 "),s("code",[this._v("app/api/v1/book.py")]),this._v(" 下的 "),s("code",[this._v("get_book")]),this._v(" 函数，在上一步中，我们只是简单的返回了一条信息，但是在真正的开发中，数据库几乎是任何应用都摆脱不了的一环。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("我们重写 "),s("code",[this._v("get_book")]),this._v(" 函数：")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-py extra-class"},[a("pre",{pre:!0,attrs:{class:"language-py"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("from")]),t._v(" lin"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("redprint "),a("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" Redprint\n"),a("span",{attrs:{class:"token keyword"}},[t._v("from")]),t._v(" flask "),a("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" jsonify\n"),a("span",{attrs:{class:"token keyword"}},[t._v("from")]),t._v(" lin"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exception "),a("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" NotFound\n"),a("span",{attrs:{class:"token keyword"}},[t._v("from")]),t._v(" app"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("models"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("book "),a("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" Book\n\nbook_api "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" Redprint"),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'book'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n\n@book_api"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("route"),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'/<id>'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" methods"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{attrs:{class:"token string"}},[t._v("'GET'")]),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("get_book")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token builtin"}},[t._v("id")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    book "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" Book"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("query"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("filter_by"),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token builtin"}},[t._v("id")]),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token builtin"}},[t._v("id")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("first"),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token comment"}},[t._v("# 通过Book模型在数据库中查询id=`id`的书籍")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" book "),a("span",{attrs:{class:"token keyword"}},[t._v("is")]),t._v(" "),a("span",{attrs:{class:"token boolean"}},[t._v("None")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{attrs:{class:"token keyword"}},[t._v("raise")]),t._v(" NotFound"),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("msg"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token string"}},[t._v("'没有找到相关书籍'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token comment"}},[t._v("# 如果书籍不存在，返回一个异常给前端")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" jsonify"),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("book"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token comment"}},[t._v("# 如果存在，返回该数据的信息")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("至此，我们再次运行根目录下的 "),s("code",[this._v("starter.py")]),this._v(" 文件，并通过 curl 再次访问"),s("code",[this._v("http://127.0.0.1:5000/v1/book/1")]),this._v("，我们会得到如下数据：")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{attrs:{class:"token string"}},[t._v('"author"')]),a("span",{attrs:{class:"token keyword"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"Randal E.Bryant"')]),t._v(",\n  "),a("span",{attrs:{class:"token string"}},[t._v('"create_time"')]),a("span",{attrs:{class:"token keyword"}},[t._v(":")]),t._v(" 1539702050000,\n  "),a("span",{attrs:{class:"token string"}},[t._v('"id"')]),a("span",{attrs:{class:"token keyword"}},[t._v(":")]),t._v(" 1,\n  "),a("span",{attrs:{class:"token string"}},[t._v('"image"')]),a("span",{attrs:{class:"token keyword"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"https://img3.doubanio.com/lpic/s1470003.jpg"')]),t._v(",\n  "),a("span",{attrs:{class:"token string"}},[t._v('"summary"')]),a("span",{attrs:{class:"token keyword"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"********"')]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"参数校验"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#参数校验","aria-hidden":"true"}},[this._v("#")]),this._v(" 参数校验")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("我们打开 "),s("code",[this._v("app/validators/forms.py")]),this._v(" 文件，向其中添加如下内容：")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-py extra-class"},[a("pre",{pre:!0,attrs:{class:"language-py"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("from")]),t._v(" wtforms "),a("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" StringField\n"),a("span",{attrs:{class:"token keyword"}},[t._v("from")]),t._v(" wtforms"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("validators "),a("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" DataRequired\n\n"),a("span",{attrs:{class:"token keyword"}},[t._v("from")]),t._v(" lin"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("forms "),a("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" Form\n\n\n"),a("span",{attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("BookSearchForm")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Form"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    q "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" StringField"),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("validators"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("DataRequired"),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("message"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token string"}},[t._v("'必须传入搜索关键字'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token comment"}},[t._v("# 前端的请求参数中必须携带`q`")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("我们新建了一个 "),s("code",[this._v("BookSearchForm")]),this._v(" 的校验类，当前端传入数据时必须携带 "),s("code",[this._v("q")]),this._v(" 这个参数，它被用来查询书籍。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("然后，我们在 "),s("code",[this._v("app/api/v1/book.py")]),this._v(" 文件中新增一个视图函数 "),s("code",[this._v("search")]),this._v(":")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-py extra-class"},[a("pre",{pre:!0,attrs:{class:"language-py"}},[a("code",[t._v("@book_api"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("route"),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'/search'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" methods"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{attrs:{class:"token string"}},[t._v("'GET'")]),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("search")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    form "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" BookSearchForm"),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("validate_for_api"),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token comment"}},[t._v("# 对前端的参数进行校验")]),t._v("\n    q "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'%'")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("+")]),t._v(" form"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("q"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data "),a("span",{attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'%'")]),t._v(" "),a("span",{attrs:{class:"token comment"}},[t._v("# 取出参数中的`q`参数，mysql的特性，加`%`进行模糊查询")]),t._v("\n    books "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" Book"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("query"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token builtin"}},[t._v("filter")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Book"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("title"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("like"),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("q"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token builtin"}},[t._v("all")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token comment"}},[t._v("# 搜索书籍标题")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" books "),a("span",{attrs:{class:"token keyword"}},[t._v("is")]),t._v(" "),a("span",{attrs:{class:"token boolean"}},[t._v("None")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("or")]),t._v(" "),a("span",{attrs:{class:"token builtin"}},[t._v("len")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("books"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("1")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{attrs:{class:"token keyword"}},[t._v("raise")]),t._v(" NotFound"),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("msg"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token string"}},[t._v("'没有找到相关书籍'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" jsonify"),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("books"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token comment"}},[t._v("# 返回书籍")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("最后，我们再次运行根目录下的 "),s("code",[this._v("starter.py")]),this._v(" 文件，并通过 curl 再次访问 "),s("code",[this._v("http://127.0.0.1:5000/v1/book/search")]),this._v("，我们会得到如下数据：")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-py extra-class"},[a("pre",{pre:!0,attrs:{class:"language-py"}},[a("code",[a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token string"}},[t._v('"error_code"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("10030")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{attrs:{class:"token string"}},[t._v('"msg"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{attrs:{class:"token string"}},[t._v('"q"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{attrs:{class:"token string"}},[t._v('"必须传入搜索关键字"')]),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{attrs:{class:"token string"}},[t._v('"request"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"GET  /v1/book/search"')]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("很明显我们未输入参数 "),s("code",[this._v("q")]),this._v("，因此校验未通过。我们修改 url 为 "),s("code",[this._v("http://127.0.0.1:5000/v1/book/search?q=C")]),this._v("，会得到如下数据：")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-py extra-class"},[a("pre",{pre:!0,attrs:{class:"language-py"}},[a("code",[a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token string"}},[t._v('"author"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"（美）Brian W. Kernighan"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{attrs:{class:"token string"}},[t._v('"create_time"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("1539702050000")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{attrs:{class:"token string"}},[t._v('"id"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("2")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{attrs:{class:"token string"}},[t._v('"image"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"https://img3.doubanio.com/lpic/s1106934.jpg"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{attrs:{class:"token string"}},[t._v('"summary"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"在计算机发展的历史上，没有哪一种程序设计语言像C语言这样应用广泛。本书原著即为C语言的设计者之一Dennis M.Ritchie和著名计算机科学家Brian W.Kernighan合著的一本介绍C语言的权威经典著作。我们现在见到的大量论述C语言程序设计的教材和专著均以此书为蓝本。原著第1版中介绍的C语言成为后来广泛使用的C语言版本——标准C的基础。人们熟知的“hello,World\\"程序就是由本书首次引入的，现在，这一程序已经成为众多程序设计语言入门的第一课。\\n原著第2版根据1987年制定的ANSIC标准做了适当的修订．引入了最新的语言形式，并增加了新的示例，通过简洁的描述、典型的示例，作者全面、系统、准确地讲述了C语言的各个特性以及程序设计的基本方法。对于计算机从业人员来说，《C程序设计语言》是一本必读的程序设计语 言方面的参考书。"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{attrs:{class:"token string"}},[t._v('"title"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"C程序设计语言"')]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"自定义异常"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#自定义异常","aria-hidden":"true"}},[this._v("#")]),this._v(" 自定义异常")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("p",[t._v("在刚才的图书搜索 API 中，当程序没有找到相关的书籍时，会抛出一个 "),a("code",[t._v("NotFound")]),t._v(" 的异常。"),a("code",[t._v("NotFound")]),t._v(" 是 Lin 基础库提供的一种异常，现在有如下需求：我们需要自定义一个 "),a("code",[t._v("BookNotFound")]),t._v(" 的异常来专门表示图书未找到。打开 "),a("code",[t._v("app/libs/error_code.py")]),t._v("，在其中添加如下内容：")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-py extra-class"},[a("pre",{pre:!0,attrs:{class:"language-py"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("BookNotFound")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("APIException"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    code "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("404")]),t._v(" "),a("span",{attrs:{class:"token comment"}},[t._v("# http状态码")]),t._v("\n    msg "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'没有找到相关图书'")]),t._v(" "),a("span",{attrs:{class:"token comment"}},[t._v("# 异常信息")]),t._v("\n    error_code "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("80010")]),t._v(" "),a("span",{attrs:{class:"token comment"}},[t._v("# 约定的异常码")]),t._v("\n")])])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"warning custom-block"},[a("p",{staticClass:"custom-block-title"},[t._v("WARNING")]),t._v(" "),a("p",[a("code",[t._v("BookNotFound")]),t._v("异常继承自"),a("code",[t._v("APIException")]),t._v("，所有继承自"),a("code",[t._v("APIException")]),t._v("的子类异常均会被框架的异常处理机制所捕捉到，并以固定的信息结构返回给前端，方便前端快速捕捉错误。\n在"),a("code",[t._v("code")]),t._v("、"),a("code",[t._v("msg")]),t._v("和"),a("code",[t._v("error_code")]),t._v("中，msg 和 error_code 异常重要，msg 能直接的告诉前端错误信息，error_code 可以让前端快速判断是何种异常。")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-py extra-class"},[a("pre",{pre:!0,attrs:{class:"language-py"}},[a("code",[t._v("@book_api"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("route"),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'/search'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" methods"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{attrs:{class:"token string"}},[t._v("'GET'")]),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("search")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    form "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" BookSearchForm"),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("validate_for_api"),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    q "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'%'")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("+")]),t._v(" form"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("q"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data "),a("span",{attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'%'")]),t._v("\n    books "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" Book"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("query"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token builtin"}},[t._v("filter")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Book"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("title"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("like"),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("q"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token builtin"}},[t._v("all")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" books "),a("span",{attrs:{class:"token keyword"}},[t._v("is")]),t._v(" "),a("span",{attrs:{class:"token boolean"}},[t._v("None")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("or")]),t._v(" "),a("span",{attrs:{class:"token builtin"}},[t._v("len")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("books"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("1")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{attrs:{class:"token keyword"}},[t._v("raise")]),t._v(" BookNotFound"),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" jsonify"),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("books"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-py extra-class"},[a("pre",{pre:!0,attrs:{class:"language-py"}},[a("code",[a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token string"}},[t._v('"error_code"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("80010")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{attrs:{class:"token string"}},[t._v('"msg"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'没有找到相关图书'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{attrs:{class:"token string"}},[t._v('"request"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"GET  /v1/book/search"')]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"小结"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#小结","aria-hidden":"true"}},[this._v("#")]),this._v(" 小结")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("到此，我们通过 "),s("code",[this._v("starter")]),this._v(" 完成了一个简单的图书 API 的开发，我们使用了如下几点：")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("使用红图细粒度的创建 API")]),this._v(" "),s("li",[this._v("使用 Model 层创建和查询数据")]),this._v(" "),s("li",[this._v("使用 WTForms 来校验参数")]),this._v(" "),s("li",[this._v("继承 APIException 来自定义异常")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("当然在本章中，我们只是一个快速上手的指导，如果你熟悉 "),s("code",[this._v("Flask")]),this._v(" 及其生态，那么你完全可以按照此种模式开发自己的应用，后续我们会讨论项目开发的基础约定和流程。")])}],!1,null,null,null);s.default=e.exports}}]);